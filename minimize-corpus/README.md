# README

Corpus is a set of inputs for a fuzz test. In most cases it refers to a set of minimal test inputs that generate maximal code coverage. Fuzz tests relies on a corpus of sample inputs for the code under test. This corpus should be seeded with collections of valid and invalid inputs for the code under test. For example, for a graphics library the initial corpus might hold a variety of different small PNG/JPG/GIF files. The fuzzer generates random mutations based around the sample inputs in the current corpus. If a mutation triggers execution of a previously-uncovered path in the code under test, then that mutation is saved to the corpus for future variations. Fuzzers will work without any initial seeds, but will be less efficient if the library under test accepts complex, structured inputs.

If you have a large corpus (either generated by fuzzing or acquired by other means) you may want to minimize it while still preserving the same coverage. There are some cases that one may want to do it, for example if you want to upload the fuzz tests into a cloud environment, trimming down the corpus size is always a good idea. Another case is that usually at the beginning of each fuzzing run, the fuzzer will load the corpus. If the corpus is too big then the fuzzer may spend 20 to 30 seconds just to process the corpus. So minimizing corpus will also help reducing the overhead of a fuzzing run.

## Example
One way to minimize a corpus is to use the `-merge=1` flag in LibFuzzer.

In the folder `minimize-corpus` we can run the following command to start the fuzzing campaign.
```
cifuzz run my_fuzz_test
```

After the run we can cancel the run and we can run the following command to minimize the corpus generated. The `NO_CIFUZZ=1` here means we want to execute LibFuzzer itself, since cifuzz currently does not support corpus minimization. The `.cifuzz-build/libfuzzer/address+undefined/my_fuzz_test` is our fuzz test's binary. Do not forget to create a new folder for the new corpus `mkdir new_corpus`.
```
NO_CIFUZZ=1 .cifuzz-build/libfuzzer/address+undefined/my_fuzz_test -merge=1 ./new_corpus .cifuzz-corpus/my_fuzz_test/
```
